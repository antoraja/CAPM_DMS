var attachRef;sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/core/Item"],(e,t,a,o)=>{"use strict";return e.extend("attachmenta5.controller.View1",{onInit(){var e=new a;this.getView().setModel(e,"attachmentItemsModel");attachRef=this;attachRef.loadAttachmentsList()},fileSizeExceed:function(e){t.show(cegControllerRef.oBundle.getText("fileSizeMustNotExceed5MB"))},fileType:function(){t.show(cegControllerRef.oBundle.getText("onlyPdfFilesAreAllowed"))},getBaseURL:function(){var e=this.getOwnerComponent().getManifestEntry("/sap.app/id");var t=e.replaceAll(".","/");var a=jQuery.sap.getModulePath(t);return a},onDownTempPressed:function(e){var a=this.getView().byId("tableInput").getValue();var o=this.getOwnerComponent().getManifestEntry("/sap.app/dataSources/mainService").uri;if(a===""){this.getView().byId("tableInput").setValueState("Error");t.show("Please Provide a Table Name")}else{this.getView().byId("tableInput").setValueState("None");var r=window.open(o+"TableStructureSet('"+a+"')/$value");if(r===null){t.show("Error generating template")}else{t.show("Template Downloaded Successfully")}}},onImport:function(e){var a=this.getView().byId("fileUploader");var o=a.oFileUpload.files;var r=this.getView().getModel("priceEstimationItemsModel");var n=this.getView().getModel("ExcelItemsModel");var s=this.getView().getModel("attachment");var l=this.getView().getModel("attachmentItemsModel");if(!o||o.length===0){sap.m.MessageToast.show("Please select a file first.");return}var i=o[0];var c=new FileReader;c.onload=function(e){var a=e.target.result;var o=(new Date).getTime()+i.name;var r=window.location.protocol+"//"+window.location.host;const n=i.type;var l={ID:"",content:a,filename:o,mime:n,url:r};s.create("/Attachments",l,{success:function(e,t){attachRef.loadAttachmentsList()},error:function(e){var a=e.message||(e.responseText?JSON.parse(e.responseText).error.message.value:"Unknown error");t.show("Error: "+a);console.log("Error upload File:",e)}})};c.readAsBinaryString(i)},onChange:async function(e){var a=this.byId("fileUploader");var o=a.getParameter("files");var r=o.files[0];var n=this;this.fileName=r.name;this.fileType=r.type;for(var s=0;s<this.getView().byId("radioButtonGroup").getButtons().length;s++){if(this.getView().byId("radioButtonGroup").getButtons()[s].getSelected()){this.operation=this.getView().byId("radioButtonGroup").getButtons()[s].getText()}}var l=new FileReader;l.onload=function(e){var a=e.currentTarget.result.match(/[^\r\n]+/g)[0].split("\t").length;var o=e.currentTarget.result.match(/[^\r\n\t]+/g);var r={Content:o};var s={slug:a+","+n.fileName+","+n.fileType+","+n.operation};n.getModel().create("/TableStructureSet",r,{headers:s,success:function(e,a){t.show("Data Uploaded Successfully!")},error:function(e){t.show("Data Uploaded Failed!")}})};l.readAsBinaryString(r)},onAttachmentAdded:async function(e){const t=e.getParameter("item").getFileObject();var a=(new Date).getTime()+t.name;const o=t.type;const r=e.getSource();const n=this.getView().getModel("attachment").oMessageParser._serviceUrl;const s=n+"/Attachments";this.getView().getModel("attachmentItemsModel").setProperty("/uploadUrl",s);r.removeAllHeaderFields();r.addHeaderField(new UploadCollectionParameter({name:"Slug",value:a}));r.addHeaderField(new UploadCollectionParameter({name:"Content-Type",value:o}));const l=await fetch(n,{method:"HEAD",credentials:"include"}).then(e=>e.headers.get("x-csrf-token"));if(l){r.addHeaderField(new sap.m.UploadCollectionParameter({name:"x-csrf-token",value:l}))}},onAfterUploadCompleted:function(){attachRef.loadAttachmentsList();this._uploadFile.close()},loadAttachmentsList:async function(){var e=this.getView().getModel("attachmentItemsModel");var t=this.getOwnerComponent().getModel("attachment");var a="/Attachments";t.read(a,{success:function(t,a){e.setData({attachmentItems:t.results});console.log(e);e.setProperty("/created",false)},error:function(e){console.log("Error in Attachment list:",e)}})},uploadFile:function(e){var a=this.getView().getModel("attachment");var o=this.getView().getModel("attachmentItemsModel");var r={ID:""};a.create("/Attachments",r,{success:function(e,t){attachRef.fileID=e.ID;o.setProperty("/created",true);attachRef.openFileAttachment()},error:function(e){var a=e.message||(e.responseText?JSON.parse(e.responseText).error.message.value:"Unknown error");t.show("Error: "+a);console.log("Error upload File:",e)}})},openFileAttachment:function(){var e=attachRef.getView();if(this._uploadFile){this._uploadFile.destroy();this._uploadFile=null}this._uploadFile=sap.ui.xmlfragment(e.getId(),"attachmenta5.view.uploadFile",this);e.addDependent(this._uploadFile);var t=this.getView().getModel("attachmentItemsModel");this._uploadFile.setModel(t);this._uploadFile.open()}})});
//# sourceMappingURL=View1.controller.js.map