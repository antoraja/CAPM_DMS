sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/Item","sap/ui/model/Filter","sap/ui/model/FilterOperator"],(e,t,n,o,s,r,a)=>{"use strict";return e.extend("sap.dms.dms.controller.attachmentView",{onInit(){this.getView().setModel(this.createAttachmentsExtensionModel(),"AttachmentsExtension")},createAttachmentID:function(){this.attachID=this.generateGUID();var e={attachID:this.attachID};this.getOwnerComponent().getModel().create("/attachmentItems",e,{success:function(e,t){sap.m.MessageToast.show("Attachment id Initialized")},error:function(e){}})},loadAttachmentsModel:function(e){var t=this.getView().getModel("inputEnableModel");var n=this.getView().getModel("attachmentItemsModel");if(e.attachments)n.setData({attachmentItems:e.attachments.results});else{var o=JSON.parse(oError.responseText);sctControllerRef._showServiceError(o);t.setProperty("/busy",false)}},getBaseURL:function(){var e=this.getOwnerComponent().getManifestEntry("/sap.app/id");var t=e.replaceAll(".","/");var n=jQuery.sap.getModulePath(t);return n},onAttachmentAdded:async function(e){const t=e.getParameter("item").getFileObject();const n=thisRef.getBaseURL();e.getSource().removeAllHeaderFields();e.getSource().addHeaderField(new s({key:"filename",text:t.name}));e.getSource().addHeaderField(new s({key:"mimetype",text:t.type}));e.getSource().addHeaderField(new s({key:"url",text:n}))},onAttachmentDelete:function(e){const t=e.getSource().getBindingContext("attachmentItemsModel");const s=this.getOwnerComponent().getModel("backendMstr");var r=t.getObject().gid;const a=`/Attachments(ID='${sctControllerRef.sctPurchaseReqNo}',app_typ='${sctControllerRef.eTenderMasterAppType}',gid='${r}')`;const c=t.getProperty("filename");const i=sctControllerRef.oBundle.getText("confirmAttachmentDeletion",[c]);n.confirm(i,{onClose:e=>{if(e===n.Action.OK){s.remove(a,{success:()=>{o.show(sctControllerRef.oBundle.getText("fileDeletedSuccessfully"));sctControllerRef.loadAttachmentsList()},error:()=>{var e=JSON.parse(oError.responseText);sctControllerRef._showServiceError(e);sctControllerRef.loadAttachmentsList()}})}}})},onAfterUploadCompleted:function(e){if(e.getParameter("status")===204){o.show("Uploaded");this.loadAttachmentsList()}else{o.show("Upload Error")}},loadAttachmentsList:async function(){var e=this.getView().getModel("attachmentItemsModel");var t=new sap.ui.model.Filter("attachID",a.EQ,this.attachID);var o=new sap.ui.model.Filter({filters:[t],and:true});var s=[o];var r=this.getOwnerComponent().getModel();var c="/attachmentItems";r.read(c,{filters:s,success:function(t){e.setData({attachmentItems:t.results});console.log(e)},error:function(e){var t=JSON.parse(e.responseText);n.error(t)}})},createAttachmentsExtensionModel:function(){const e=new t({uploadUrl:"",fileTypes:"pdf,png",mediaTypes:"application/pdf,image/png"});return e},onFilenamePress:function(e){const t=e.getSource().getBindingContext();const n=t.getPath();const o=t.getModel().sServiceUrl;const s=o.indexOf("/")===2?o.substring(2):o;const r=s+n+"/content";window.open(r,"_blank")},onBeforeInitiatingItemUpload:function(e){this.createAttachmentID();const t=e.getParameter("item").getFileObject();e.getSource().removeAllHeaderFields();e.getSource().addHeaderField(new s({key:"filename",text:t.name}));e.getSource().addHeaderField(new s({key:"mimetype",text:t.type}));const n="/attachmentItems(attachID='"+this.attachID+"')";const o=this.getView().getModel().sServiceUrl;const r=o.indexOf("/")===2?o.substring(2):o;const a=r+n+"/content";this.getView().getModel("AttachmentsExtension").setProperty("/uploadUrl",a)},onUploadCompleted:function(e){e.getSource().removeAllHeaderFields();this._refreshModel()},_refreshModel:function(){const e=this.getView().getModel();e.refresh()},onDeleteButtonPress:function(e){const t=e.getSource().getBindingContext();const o=t.getModel();const s=t.getPath();const r=t.getProperty("filename");const a=this.getView().getModel("i18n").getResourceBundle().getText("confirmAttachmentDeletion",[r]);n.confirm(a,{onClose:e=>{if(e===n.Action.OK){o.remove(s,{error:()=>{this._refreshModel()}})}}})},generateGUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;const n=e==="x"?t:t&3|8;return n.toString(16)})}})});
//# sourceMappingURL=attachmentView.controller.js.map